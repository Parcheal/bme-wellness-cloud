<!-- pages/profile-setup/profile-setup.wxml -->
<view class="container">
  <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
  <view class="progress-container">
    <view class="progress-bar">
      <view class="progress-fill" style="width: {{(currentStep + 1) / 4 * 100}}%"></view>
    </view>
    <view class="progress-text">ç¬¬{{currentStep + 1}}æ­¥ï¼Œå…±4æ­¥</view>
  </view>

  <!-- æ­¥éª¤å†…å®¹ -->
  <view class="step-container">
    <!-- ç¬¬1æ­¥ï¼šåŸºæœ¬ä¿¡æ¯ -->
    <view class="step-content" wx:if="{{currentStep === 0}}">
      <view class="step-title">åŸºæœ¬ä¿¡æ¯</view>
        
        <view class="form-group">
          <text class="label">å§“å *</text>
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" 
            value="{{basicInfo.name}}"
            data-field="name"
            bindinput="onBasicInfoInput"
          />
        </view>

        <view class="form-group">
          <text class="label">å¹´é¾„ *</text>
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥å¹´é¾„" 
            type="number"
            value="{{basicInfo.age}}"
            data-field="age"
            bindinput="onBasicInfoInput"
          />
        </view>

        <view class="form-group">
          <text class="label">æ€§åˆ« *</text>
          <radio-group bindchange="onGenderChange">
            <label class="radio-item">
              <radio value="ç”·" checked="{{basicInfo.gender === 'ç”·'}}" color="#6E0382"/>
              <text>ç”·</text>
            </label>
            <label class="radio-item">
              <radio value="å¥³" checked="{{basicInfo.gender === 'å¥³'}}" color="#6E0382"/>
              <text>å¥³</text>
            </label>
          </radio-group>
        </view>

        <view class="form-group">
          <text class="label">èº«é«˜ (cm) *</text>
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥èº«é«˜" 
            type="number"
            value="{{basicInfo.height}}"
            data-field="height"
            bindinput="onBasicInfoInput"
          />
        </view>

        <view class="form-group">
          <text class="label">ä½“é‡ (kg) *</text>
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥ä½“é‡" 
            type="number"
            value="{{basicInfo.weight}}"
            data-field="weight"
            bindinput="onBasicInfoInput"
          />
        </view>

        <view class="form-group">
          <text class="label">èŒä¸š</text>
          <input 
            class="input" 
            placeholder="è¯·è¾“å…¥èŒä¸šï¼ˆå¯é€‰ï¼‰" 
            value="{{basicInfo.occupation}}"
            data-field="occupation"
            bindinput="onBasicInfoInput"
          />
        </view>
    </view>

    <!-- ç¬¬2æ­¥ï¼šç–¾ç—…å² -->
    <view class="step-content" wx:if="{{currentStep === 1}}">
      <view class="step-title">å¥åº·çŠ¶å†µ</view>
        
        <view class="form-group">
          <text class="label">æ…¢æ€§ç–¾ç—…</text>
          <textarea 
            class="textarea" 
            placeholder="è¯·åˆ—å‡ºæ‚¨çš„æ…¢æ€§ç–¾ç—…ï¼ˆå¦‚é«˜è¡€å‹ã€ç³–å°¿ç—…ç­‰ï¼‰ï¼Œæ²¡æœ‰è¯·å¡«æ— " 
            value="{{medicalHistory.chronicDiseases}}"
            data-field="chronicDiseases"
            bindinput="onMedicalHistoryInput"
          />
        </view>

        <view class="form-group">
          <text class="label">è¿‡æ•å²</text>
          <textarea 
            class="textarea" 
            placeholder="è¯·åˆ—å‡ºæ‚¨çš„è¿‡æ•å²ï¼ˆå¦‚èŠ±ç²‰ã€æµ·é²œç­‰ï¼‰ï¼Œæ²¡æœ‰è¯·å¡«æ— " 
            value="{{medicalHistory.allergies}}"
            data-field="allergies"
            bindinput="onMedicalHistoryInput"
          />
        </view>

        <view class="form-group">
          <text class="label">å½“å‰ç”¨è¯</text>
          <textarea 
            class="textarea" 
            placeholder="è¯·åˆ—å‡ºæ‚¨å½“å‰æ­£åœ¨æœç”¨çš„è¯ç‰©ï¼Œæ²¡æœ‰è¯·å¡«æ— " 
            value="{{medicalHistory.currentMedications}}"
            data-field="currentMedications"
            bindinput="onMedicalHistoryInput"
          />
        </view>

        <view class="form-group">
          <text class="label">å®¶æ—ç—…å²</text>
          <textarea 
            class="textarea" 
            placeholder="è¯·ç®€è¿°ç›´ç³»äº²å±çš„ä¸»è¦ç–¾ç—…å²ï¼Œæ²¡æœ‰è¯·å¡«æ— " 
            value="{{medicalHistory.familyHistory}}"
            data-field="familyHistory"
            bindinput="onMedicalHistoryInput"
          />
        </view>
    </view>

    <!-- ç¬¬3æ­¥ï¼šé¥®é£Ÿåå¥½ -->
    <view class="step-content" wx:if="{{currentStep === 2}}">
      <view class="step-title">é¥®é£Ÿåå¥½</view>
        
        <view class="form-group">
          <text class="label">è¾£åº¦åå¥½ï¼š{{dietaryPreferences.spiciness}}/5</text>
          <slider 
            class="slider" 
            min="1" 
            max="5" 
            value="{{dietaryPreferences.spiciness}}"
            data-field="spiciness"
            bindchange="onPreferenceSliderChange"
            activeColor="#6E0382"
            show-value
          />
          <view class="slider-desc">1=ä¸åƒè¾£ åˆ° 5=å¾ˆèƒ½åƒè¾£</view>
        </view>

        <view class="form-group">
          <text class="label">ç”œåº¦åå¥½ï¼š{{dietaryPreferences.sweetness}}/5</text>
          <slider 
            class="slider" 
            min="1" 
            max="5" 
            value="{{dietaryPreferences.sweetness}}"
            data-field="sweetness"
            bindchange="onPreferenceSliderChange"
            activeColor="#6E0382"
            show-value
          />
          <view class="slider-desc">1=ä¸çˆ±ç”œé£Ÿ åˆ° 5=å¾ˆçˆ±ç”œé£Ÿ</view>
        </view>

        <view class="form-group">
          <text class="label">é¥®é£Ÿæ¸©åº¦åå¥½</text>
          <radio-group bindchange="onTemperatureChange">
            <label class="radio-item">
              <radio value="cold" checked="{{dietaryPreferences.temperature === 'cold'}}" color="#6E0382"/>
              <text>åçˆ±å†·é£Ÿ</text>
            </label>
            <label class="radio-item">
              <radio value="normal" checked="{{dietaryPreferences.temperature === 'normal'}}" color="#6E0382"/>
              <text>å¸¸æ¸©å³å¯</text>
            </label>
            <label class="radio-item">
              <radio value="hot" checked="{{dietaryPreferences.temperature === 'hot'}}" color="#6E0382"/>
              <text>åçˆ±çƒ­é£Ÿ</text>
            </label>
          </radio-group>
        </view>

        <view class="form-group">
          <text class="label">è¤ç´ åå¥½</text>
          <radio-group bindchange="onMeatPreferenceChange">
            <label class="radio-item">
              <radio value="vegetarian" checked="{{dietaryPreferences.meatPreference === 'vegetarian'}}" color="#6E0382"/>
              <text>ç´ é£Ÿä¸»ä¹‰</text>
            </label>
            <label class="radio-item">
              <radio value="mixed" checked="{{dietaryPreferences.meatPreference === 'mixed'}}" color="#6E0382"/>
              <text>è¤ç´ æ­é…</text>
            </label>
            <label class="radio-item">
              <radio value="meat" checked="{{dietaryPreferences.meatPreference === 'meat'}}" color="#6E0382"/>
              <text>åçˆ±è‚‰é£Ÿ</text>
            </label>
          </radio-group>
        </view>

        <view class="form-group">
          <text class="label">ç”¨é¤æ—¶é—´</text>
          <view class="time-group">
            <view class="time-item">
              <text>æ—©é¤ï¼š</text>
              <picker mode="time" value="{{dietaryPreferences.eatingTime.breakfast}}" data-meal="breakfast" bindchange="onEatingTimeChange">
                <view class="time-picker">{{dietaryPreferences.eatingTime.breakfast}}</view>
              </picker>
            </view>
            <view class="time-item">
              <text>åˆé¤ï¼š</text>
              <picker mode="time" value="{{dietaryPreferences.eatingTime.lunch}}" data-meal="lunch" bindchange="onEatingTimeChange">
                <view class="time-picker">{{dietaryPreferences.eatingTime.lunch}}</view>
              </picker>
            </view>
            <view class="time-item">
              <text>æ™šé¤ï¼š</text>
              <picker mode="time" value="{{dietaryPreferences.eatingTime.dinner}}" data-meal="dinner" bindchange="onEatingTimeChange">
                <view class="time-picker">{{dietaryPreferences.eatingTime.dinner}}</view>
              </picker>
            </view>
          </view>
        </view>
    </view>

    <!-- ç¬¬4æ­¥ï¼šä¸­åŒ»ä½“è´¨æµ‹è¯• -->
    <view class="step-content" wx:if="{{currentStep === 3}}">
      <view class="step-title">ä¸­åŒ»ä½“è´¨æµ‹è¯•</view>
        <view class="step-desc">è¯·æ ¹æ®æ‚¨çš„å®é™…æƒ…å†µé€‰æ‹©æœ€ç¬¦åˆçš„ç­”æ¡ˆ</view>
        
        <view class="question-list">
          <view class="question-item" wx:for="{{constitutionQuestions}}" wx:key="id">
            <view class="question-text">{{index + 1}}. {{item.question}}</view>
            <radio-group data-question-id="{{item.id}}" bindchange="onConstitutionAnswer">
              <label class="option-item" wx:for="{{item.options}}" wx:for-item="option" wx:for-index="optionIndex" wx:key="optionIndex">
                <radio value="{{optionIndex}}" checked="{{constitutionTest.answers[item.id] == optionIndex}}" color="#6E0382"/>
                <text class="option-text">{{option}}</text>
              </label>
            </radio-group>
          </view>
        </view>
    </view>
  </view>

  <!-- æµ‹è¯•åŒºåŸŸ -->
  <view class="test-section" wx:if="{{currentStep === 0}}">
    <view class="test-title">ğŸ§ª æµ‹è¯•åŠŸèƒ½</view>
    <button class="test-btn" bindtap="fillTestData">å¡«å……æµ‹è¯•æ•°æ®</button>
    <text class="test-desc">å¿«é€Ÿå¡«å…¥æµ‹è¯•æ•°æ®ï¼Œæ–¹ä¾¿æµ‹è¯•åŠŸèƒ½</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="button-group">
    <button 
      class="btn btn-secondary" 
      wx:if="{{currentStep > 0}}" 
      bindtap="prevStep"
    >
      ä¸Šä¸€æ­¥
    </button>
    
    <button 
      class="btn btn-primary" 
      bindtap="nextStep"
    >
      {{currentStep < 3 ? 'ä¸‹ä¸€æ­¥' : 'å®Œæˆå¹¶åˆ†æä½“è´¨'}}
    </button>
  </view>
</view>
