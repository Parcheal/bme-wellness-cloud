<!-- pages/home/home.wxml -->
<view class="container">
  <!-- å¤´éƒ¨ä¿¡æ¯ -->
  <view class="header">
    <text class="welcome">ä»Šæ—¥å…»ç”Ÿæ‰“å¡</text>
    <text class="date">{{currentWeek[0].date}} è‡³ {{currentWeek[6].date}}</text>
  </view>

  <!-- ä¸€å‘¨21é¡¿å±•ç¤º -->
  <view class="week-container">
    <view class="week-header">
      <text class="week-title">æœ¬å‘¨é¥®é£Ÿè®°å½•</text>
      <text class="week-subtitle">ç‚¹å‡»é¤æ¬¡è¿›è¡Œæ‰“å¡</text>
    </view>
    
    <view class="week-grid">
      <view class="day-column" wx:for="{{currentWeek}}" wx:key="date">
        <view class="day-header">{{item.dayName}}</view>
        <view class="day-date">{{item.date.split('-')[2]}}</view>
        
        <!-- ä¸‰é¤ -->
        <view class="meal-list">
          <view 
            class="meal-item {{item.meals.breakfast.completed ? 'completed' : ''}} {{!item.meals.breakfast.healthy ? 'unhealthy' : ''}}"
            data-date="{{item.date}}"
            data-meal="breakfast"
            bindtap="onMealTap"
          >
            <text class="meal-name">æ—©</text>
            <view class="meal-status">
              <text wx:if="{{item.meals.breakfast.completed}}">âœ“</text>
              <text wx:else>â—‹</text>
            </view>
          </view>
          
          <view 
            class="meal-item {{item.meals.lunch.completed ? 'completed' : ''}} {{!item.meals.lunch.healthy ? 'unhealthy' : ''}}"
            data-date="{{item.date}}"
            data-meal="lunch"
            bindtap="onMealTap"
          >
            <text class="meal-name">åˆ</text>
            <view class="meal-status">
              <text wx:if="{{item.meals.lunch.completed}}">âœ“</text>
              <text wx:else>â—‹</text>
            </view>
          </view>
          
          <view 
            class="meal-item {{item.meals.dinner.completed ? 'completed' : ''}} {{!item.meals.dinner.healthy ? 'unhealthy' : ''}}"
            data-date="{{item.date}}"
            data-meal="dinner"
            bindtap="onMealTap"
          >
            <text class="meal-name">æ™š</text>
            <view class="meal-status">
              <text wx:if="{{item.meals.dinner.completed}}">âœ“</text>
              <text wx:else>â—‹</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ±‡æ€» -->
  <view class="today-summary">
    <view class="summary-title">ä»Šæ—¥æ±‡æ€»</view>
    <view class="summary-content">
      <view class="summary-item">
        <text class="summary-label">å·²æ‰“å¡ï¼š</text>
        <text class="summary-value">
          {{(todayMeals.breakfast.completed ? 1 : 0) + (todayMeals.lunch.completed ? 1 : 0) + (todayMeals.dinner.completed ? 1 : 0)}}/3 é¤
        </text>
      </view>
      <view class="summary-item">
        <text class="summary-label">å¥åº·åº¦ï¼š</text>
        <text class="summary-value">
          {{((todayMeals.breakfast.healthy ? 1 : 0) + (todayMeals.lunch.healthy ? 1 : 0) + (todayMeals.dinner.healthy ? 1 : 0)) * 100 / 3}}%
        </text>
      </view>
    </view>
  </view>

  <!-- æ‰“å¡å¼¹çª— -->
  <view class="modal" wx:if="{{showCheckIn}}" catchtouchmove="true">
    <view class="modal-mask" bindtap="closeCheckIn"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">{{selectedMeal === 'breakfast' ? 'æ—©é¤' : selectedMeal === 'lunch' ? 'åˆé¤' : 'æ™šé¤'}}æ‰“å¡</text>
        <view class="modal-close" bindtap="closeCheckIn">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="form-group">
          <text class="label">ä»Šå¤©åƒäº†ä»€ä¹ˆï¼Ÿ</text>
          <textarea
            class="food-input"
            placeholder="è¯·è¾“å…¥é£Ÿç‰©ï¼Œå¦‚ï¼šå°ç±³ç²¥ï¼Œè’¸è›‹ï¼Œé’èœ..."
            value="{{foodInput}}"
            bindinput="onFoodInput"
            maxlength="200"
          />
        </view>
        
        <view class="form-group">
          <text class="label">å¿ƒæƒ…å¦‚ä½•ï¼Ÿ{{currentMood}}/5</text>
          <slider
            class="mood-slider"
            min="1"
            max="5"
            value="{{currentMood}}"
            bindchange="onMoodChange"
            activeColor="#6E0382"
            show-value
          />
          <view class="mood-desc">
            <text>å¾ˆä¸å¥½</text>
            <text>å¾ˆå¼€å¿ƒ</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeCheckIn">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="saveCheckIn">ä¿å­˜</button>
      </view>
    </view>
  </view>

  <!-- ç”¨æˆ·çŠ¶æ€æ˜¾ç¤º -->
  <view class="status-section">
    <view class="status-title">ğŸ“± å½“å‰çŠ¶æ€</view>
    <view class="status-item">
      <text class="status-label">ç™»å½•çŠ¶æ€ï¼š</text>
      <text class="status-value">{{userInfo ? 'å·²ç™»å½•' : 'æœªç™»å½•'}}</text>
    </view>
    <view class="status-item" wx:if="{{userInfo}}">
      <text class="status-label">ç”¨æˆ·æ¡£æ¡ˆï¼š</text>
      <text class="status-value">{{userProfile ? 'å·²å®Œå–„' : 'æœªå®Œå–„'}}</text>
    </view>
    <view class="status-buttons" wx:if="{{!userInfo}}">
      <button class="status-btn" bindtap="quickLogin">å¿«é€Ÿç™»å½•æµ‹è¯•</button>
    </view>
  </view>

  <!-- äº‘å‡½æ•°æµ‹è¯•åŒºåŸŸ -->
  <view class="test-section">
    <view class="test-title">ğŸ”§ äº‘å‡½æ•°æµ‹è¯•</view>
    <view class="test-buttons">
      <button class="test-btn" bindtap="testSaveMealRecordDirectly">æµ‹è¯• saveMealRecord</button>
      <button class="test-btn secondary" bindtap="testGetMealRecords">æµ‹è¯• getMealRecords</button>
    </view>
    <text class="test-desc">ç‚¹å‡»æµ‹è¯•é¤é¥®è®°å½•çš„ä¿å­˜å’ŒæŸ¥è¯¢åŠŸèƒ½</text>
  </view>

  <!-- æç¤ºä¿¡æ¯ -->
  <view class="tip" wx:if="{{!userProfile}}">
    <text class="tip-text">æç¤ºï¼šå®Œå–„ä¸ªäººä¿¡æ¯å¯è·å¾—æ›´ç²¾å‡†çš„å¥åº·å»ºè®®</text>
    <button class="tip-btn" bindtap="goToProfile">å»å®Œå–„</button>
  </view>
</view>
