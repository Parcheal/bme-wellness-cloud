<!--pages/social/social.wxml-->
<view class="social-container">
  
  <!-- é¡¶éƒ¨ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-item {{currentFilter === 'all' ? 'active' : ''}}" data-filter="all" bindtap="switchFilter">
      å…¨éƒ¨
    </view>
    <view class="filter-item {{currentFilter === 'meal' ? 'active' : ''}}" data-filter="meal" bindtap="switchFilter">
      ç¾é£Ÿ
    </view>
    <view class="filter-item {{currentFilter === 'experience' ? 'active' : ''}}" data-filter="experience" bindtap="switchFilter">
      å¿ƒå¾—
    </view>
    <view class="filter-item {{currentFilter === 'tips' ? 'active' : ''}}" data-filter="tips" bindtap="switchFilter">
      æŠ€å·§
    </view>
  </view>

  <!-- å‘å¸ƒæŒ‰é’® -->
  <view class="publish-btn" bindtap="showShareDialog">
    <text class="iconfont">âœï¸</text>
    <text>åˆ†äº«</text>
  </view>

  <!-- åŠ¨æ€åˆ—è¡¨ -->
  <scroll-view class="posts-container" scroll-y="true" bindscrolltolower="onReachBottom">
    <!-- åŠ è½½çŠ¶æ€ -->
    <view wx:if="{{loading && posts.length === 0}}" class="loading-container">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{!loading && posts.length === 0}}" class="empty-container">
      <text class="empty-icon">ğŸŒ±</text>
      <text class="empty-text">è¿˜æ²¡æœ‰åŠ¨æ€å“¦</text>
      <text class="empty-desc">å¿«æ¥åˆ†äº«ä½ çš„å…»ç”Ÿå¿ƒå¾—å§</text>
    </view>

    <!-- åŠ¨æ€åˆ—è¡¨ -->
    <view wx:for="{{posts}}" wx:key="postId" class="post-item">
      <!-- ç”¨æˆ·ä¿¡æ¯ -->
      <view class="post-header">
        <view class="user-info" data-user-id="{{item.author.userId}}" bindtap="viewUserProfile">
          <view class="avatar">{{item.author.name.charAt(0)}}</view>
          <view class="user-details">
            <text class="username">{{item.author.name}}</text>
            <text class="constitution">{{item.author.constitution}}</text>
          </view>
        </view>
        <text class="post-time">{{item.createdAt}}</text>
      </view>

      <!-- åŠ¨æ€å†…å®¹ -->
      <view class="post-content">
        <text class="content-text">{{item.content}}</text>
        
        <!-- å…³è”çš„é¤é¥®è®°å½• -->
        <view wx:if="{{item.mealRecord}}" class="meal-record">
          <view class="meal-info">
            <text class="meal-label">ğŸ½ï¸ åˆ†äº«é¤é£Ÿï¼š</text>
            <text class="meal-text">{{item.mealRecord.mealText}}</text>
            <text class="meal-emotion">å¿ƒæƒ…ï¼š{{item.mealRecord.emotion}}</text>
          </view>
        </view>

        <!-- å›¾ç‰‡å±•ç¤º -->
        <view wx:if="{{item.images.length > 0}}" class="post-images">
          <image wx:for="{{item.images}}" wx:for-item="img" wx:key="index" 
                 src="{{img}}" class="post-image" mode="aspectFill" lazy-load="true"/>
        </view>

        <!-- æ ‡ç­¾ -->
        <view wx:if="{{item.tags.length > 0}}" class="post-tags">
          <text wx:for="{{item.tags}}" wx:key="index" class="tag">#{{item}}</text>
        </view>
      </view>

      <!-- äº’åŠ¨æ  -->
      <view class="post-actions">
        <view class="action-item" data-post-id="{{item.postId}}" data-is-liked="{{item.isLiked}}" bindtap="likePost">
          <text class="action-icon {{item.isLiked ? 'liked' : ''}}">â¤ï¸</text>
          <text class="action-text">{{item.likes}}</text>
        </view>
        <view class="action-item">
          <text class="action-icon">ğŸ’¬</text>
          <text class="action-text">{{item.comments}}</text>
        </view>
        <view class="action-item" data-content="{{item.content}}" bindtap="shareToWeChat">
          <text class="action-icon">ğŸ“¤</text>
          <text class="action-text">åˆ†äº«</text>
        </view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading && posts.length > 0}}" class="loading-more">
      <text>åŠ è½½æ›´å¤š...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view wx:if="{{!hasMore && posts.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šäº†</text>
    </view>
  </scroll-view>

  <!-- åˆ†äº«å¼¹çª— -->
  <view wx:if="{{showShareDialog}}" class="share-modal">
    <view class="modal-mask" bindtap="closeShareDialog"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">åˆ†äº«å…»ç”ŸåŠ¨æ€</text>
        <text class="modal-close" bindtap="closeShareDialog">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- å†…å®¹è¾“å…¥ -->
        <textarea 
          class="share-input"
          placeholder="åˆ†äº«ä½ çš„å…»ç”Ÿå¿ƒå¾—ã€å¥åº·é¤é£Ÿæˆ–å°æŠ€å·§..."
          value="{{shareContent}}"
          bindinput="onShareContentInput"
          maxlength="300"
          auto-height="true">
        </textarea>

        <!-- å›¾ç‰‡é€‰æ‹© -->
        <view class="image-section">
          <text class="section-title">æ·»åŠ å›¾ç‰‡</text>
          <view class="image-list">
            <view wx:for="{{shareImages}}" wx:key="index" class="image-item">
              <image src="{{item}}" class="share-image"/>
              <view class="image-delete" data-index="{{index}}" bindtap="removeShareImage">Ã—</view>
            </view>
            <view wx:if="{{shareImages.length < 3}}" class="add-image" bindtap="chooseShareImages">
              <text class="add-icon">+</text>
              <text class="add-text">æ·»åŠ å›¾ç‰‡</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="cancel-btn" bindtap="closeShareDialog">å–æ¶ˆ</button>
        <button class="publish-btn-modal" bindtap="publishShare">å‘å¸ƒ</button>
      </view>
    </view>
  </view>
</view>
