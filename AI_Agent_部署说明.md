# 微信小程序 AI Agent 部署说明

## 📋 功能概述

本项目在原有微信小程序登录功能基础上，新增了AI智能助手功能，用户可以通过输入问题获得AI回复。

## 🔧 后端部署（LeanCloud 云引擎）

### 1. 安装依赖
在云引擎项目根目录执行：
```bash
npm install
```

### 2. 环境变量配置
在 LeanCloud 云引擎控制台设置以下环境变量：

| 变量名 | 说明 | 示例值 |
|-------|------|-------|
| `CHATANYWHERE_API_KEY` | ChatAnywhere API密钥 | `sk-xxxxxxxxxxxxxxxx` |
| `LEANCLOUD_APP_ID` | LeanCloud应用ID | 自动设置 |
| `LEANCLOUD_APP_KEY` | LeanCloud应用Key | 自动设置 |
| `LEANCLOUD_APP_MASTER_KEY` | LeanCloud主密钥 | 自动设置 |

### 3. 部署到云引擎
使用 LeanCloud 控制台或命令行工具部署：
```bash
lean deploy
```

### 4. 获取云引擎域名
部署成功后，在控制台获取云引擎域名，格式如：
```
https://你的应用名.leanapp.cn
```

## 🎨 前端配置

### 1. 修改API地址
在 `pages/index/index.js` 文件第122行，将URL替换为你的实际云引擎域名：
```javascript
url: 'https://你的云引擎域名/agent',
```
修改为：
```javascript
url: 'https://你的应用名.leanapp.cn/agent',
```

### 2. 小程序服务器域名配置
在微信小程序管理后台，将你的云引擎域名添加到服务器域名白名单：
- 登录 [微信公众平台](https://mp.weixin.qq.com)
- 进入"开发" -> "开发管理" -> "开发设置"
- 在"服务器域名"中添加你的云引擎域名

## 🚀 使用说明

### 界面布局
- **登录区域**：保留原有的用户名/密码登录功能
- **AI助手区域**：新增的AI智能对话区域
  - 问题输入框：支持多行输入，最多500字符
  - 发送问题按钮：点击发送问题给AI
  - 清空对话按钮：清空当前对话内容
  - AI回复区域：显示AI的回复内容

### 功能特点
- ✅ 保留原有登录功能不变
- ✅ 美观的UI设计，与原界面风格统一
- ✅ 支持长文本输入和回复
- ✅ 完善的错误处理和用户提示
- ✅ 加载状态显示，提升用户体验

## 🔍 API 接口说明

### POST /agent

**请求格式：**
```json
{
  "message": "用户输入的问题"
}
```

**成功响应：**
```json
{
  "reply": "AI生成的回复内容"
}
```

**错误响应：**
```json
{
  "error": "错误原因描述"
}
```

## ⚠️ 注意事项

1. **API密钥安全**：请确保 `CHATANYWHERE_API_KEY` 环境变量正确设置
2. **网络配置**：确保小程序服务器域名白名单包含云引擎域名
3. **费用控制**：ChatAnywhere API按使用量计费，建议设置合理的使用限制
4. **错误处理**：代码已包含完善的错误处理，遇到问题请查看控制台日志

## 🐛 常见问题

### 1. "网络错误"提示
- 检查小程序服务器域名配置
- 确认云引擎是否正常运行
- 检查网络连接

### 2. "API密钥无效"错误
- 检查环境变量 `CHATANYWHERE_API_KEY` 是否正确设置
- 确认API密钥是否有效且有余额

### 3. 部署失败
- 检查 `package.json` 中的依赖是否正确
- 确认Node.js版本兼容性
- 查看LeanCloud控制台错误日志

## 📞 技术支持

如遇到问题，请检查：
1. LeanCloud 云引擎控制台日志
2. 微信开发者工具控制台错误
3. 网络连接和域名配置

---

部署完成后，用户可以在登录界面下方看到AI智能助手功能，输入问题即可获得AI回复！
